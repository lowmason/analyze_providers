# Data sources

## Payroll provider data (input)

A client–month panel with the following fields, in this order:

| Field | Description |
|-------|-------------|
| `client_id` | Unique client identifier |
| `ref_date` | Monthly reference date, 2019-01 through 2026-01. Employment measured as of the 12th of each month (CES-compatible pay period) |
| `entry_month` | First month the client appears in the data |
| `exit_month` | Last month the client appears (null if still active) |
| `is_birth` | Boolean or null. `True` if the client's EIN registration date is within ±3 months of their entry into the payroll provider's client base. `False` if the EIN date is available but outside that window. `null` if EIN registration date is unavailable. **Sparse but reliable when non-null.** |
| `naics_code` | 6-digit NAICS industry code |
| `state_fips` | State FIPS code |
| `qualified_employment` | Total employees with CES-qualified pay |

Input is one or more **parquet** files. The loader accepts a single file path or a directory (scans `*.parquet`). The package validates that these columns exist and adds derived columns: `naics2`, `naics3`, `supersector`, `size_class`, `quarter`.

---

## Official statistics (eco-stats)

Official data is fetched using the [eco-stats](https://github.com/lowmason/eco-stats) library. The main entry point is **BLSClient**, which provides:

1. **JSON API** — `get_series()` for time-series by series ID  
2. **Flat files** — `get_bulk_data()`, `get_mapping()` from download.bls.gov  
3. **QCEW CSV slices** — `get_qcew_industry()`, `get_qcew_area()`, `get_qcew_size()` from the CEW open-data API  

All methods return **polars** DataFrames. Time-series use a `date` column with **day=12** for CE (CES) and EN (QCEW) to match the survey reference period.

| Program | eco-stats access | Notes |
|--------|------------------|--------|
| **QCEW** | `get_qcew_industry()`, `get_qcew_area()`, `get_qcew_size()` | Size data is Q1 only. CSV slice API. |
| **CES** | `get_series()`, `get_employment()`, `get_bulk_data('CE')` | Series IDs via `build_series_id('CE', seasonal='S', supersector='00', ...)` |
| **BED** | `get_series()`, `get_bulk_data('BD')` | Series IDs via `build_series_id('BD', ...)`. Mappings: `get_mapping('BD', 'dataelement')`, etc. |

**Lookup tables** — e.g. `get_mapping('CE', 'supersector')`, `get_mapping('BD', 'dataelement')`, `get_mapping('BD', 'sizeclass')`, `get_mapping('BD', 'state')`.

**Series ID helpers** — `build_series_id(program, **components)`, `parse_series_id(series_id)`.

Install eco-stats:

```bash
pip install git+https://github.com/lowmason/eco-stats.git
```

Set `BLS_API_KEY` in the environment or pass `api_key` to `BLSClient()`.

---

## Temporal alignment

- **Payroll** `ref_date`: month with day=12.  
- **CES**: eco-stats returns `date` with day=12 for CE.  
- **QCEW**: use quarter and month-in-quarter; e.g. `month1_emplvl` = first month of quarter (Jan for Q1). The package aligns payroll to QCEW by quarter and month position when computing coverage.

This alignment is documented in the methodology section of the technical appendix generated by the pipeline.
